# üöÄ Unified OCR Server

–°–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π 4 —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ –º–µ—Ç—Ä–∏–∫–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.

![OCR Server Architecture](https://via.placeholder.com/800x400?text=OCR+Server+Architecture+Diagram)

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#Ô∏è-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
  - [–õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫](#–ª–æ–∫–∞–ª—å–Ω—ã–π-–∑–∞–ø—É—Å–∫)
  - [–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker](#–∑–∞–ø—É—Å–∫-—á–µ—Ä–µ–∑-docker)
  - [–†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π](#—Ä–µ–∂–∏–º-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏-—Å-–∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
- [üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
  - [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
  - [–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ curl](#–ø—Ä–∏–º–µ—Ä—ã-–∑–∞–ø—Ä–æ—Å–æ–≤-—á–µ—Ä–µ–∑-curl)
  - [Python –∫–ª–∏–µ–Ω—Ç](#python-–∫–ª–∏–µ–Ω—Ç)
  - [–ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤](#–ø—Ä–∏–º–µ—Ä—ã-–æ—Ç–≤–µ—Ç–æ–≤)
- [üß† –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏](#-–≤—ã–±–æ—Ä-–º–æ–¥–µ–ª–∏)
- [üìä –ú–µ—Ç—Ä–∏–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏](#-–º–µ—Ç—Ä–∏–∫–∞-—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏)
- [üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **4 —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏**:
  - `deepseek-ocr` ‚Äî –±–∞–∑–æ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (1.3B)
  - `deepseek-ocr2` ‚Äî —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (3B)
  - `paddleocr-vl-1.5` ‚Äî –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (–∫–∏—Ç–∞–π—Å–∫–∏–π, —è–ø–æ–Ω—Å–∫–∏–π, –∫–æ—Ä–µ–π—Å–∫–∏–π) (0.9B)
  - `glm-ocr` ‚Äî –±—ã—Å—Ç—Ä–æ–µ –∏ –ª—ë–≥–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ (0.9B)
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö PDF** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚úÖ **–ú–µ—Ç—Ä–∏–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏** ‚Äî —Ç–æ–∫–µ–Ω–Ω–∞—è + —ç–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
- ‚úÖ **–ì–∏–±–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ä–æ—Ç–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å. 3 —Ñ–∞–π–ª–∞ –ø–æ 3 –ú–ë), —Ü–≤–µ—Ç–Ω–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π** ‚Äî –ª–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–≤–æ–¥** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, —Å–ø–∏—Å–∫–æ–≤ –∏ –∏–µ—Ä–∞—Ä—Ö–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
OCR/
‚îú‚îÄ‚îÄ app.py                     # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ FastAPI
‚îú‚îÄ‚îÄ requirements.txt           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ run_dev.sh                 # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ Dockerfile                 # Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ models/                    # –ú–æ–¥—É–ª–∏ –º–æ–¥–µ–ª–µ–π OCR
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ deepseek_ocr.py        # DeepSeek-OCR (1.3B)
‚îÇ   ‚îú‚îÄ‚îÄ deepseek_ocr2.py       # DeepSeek-OCR 2 (3B)
‚îÇ   ‚îú‚îÄ‚îÄ paddleocr_vl.py        # PaddleOCR-VL-1.5 (0.9B)
‚îÇ   ‚îî‚îÄ‚îÄ glm_ocr.py             # GLM-OCR (0.9B)
‚îî‚îÄ‚îÄ utils/                     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ __init__.py            # –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ —É—Ç–∏–ª–∏—Ç
    ‚îú‚îÄ‚îÄ logger.py              # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îú‚îÄ‚îÄ pdf_handler.py         # –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö PDF
    ‚îî‚îÄ‚îÄ confidence.py          # –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
```

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –í–µ—Ä—Å–∏—è | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| **Python** | 3.11+ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3.11 |
| **CUDA** | 12.4 | –î–ª—è —Ä–∞–±–æ—Ç—ã —Å GPU |
| **GPU** | 8+ –ì–ë VRAM | –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –æ–¥–Ω–æ–π –º–æ–¥–µ–ª–∏; 24+ –ì–ë –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ |
| **–î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ** | 10+ –ì–ë | –î–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π |
| **–û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞** | Linux | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è Ubuntu 22.04+ |
| **Docker** | 24.0+ | –î–ª—è –∑–∞–ø—É—Å–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| **NVIDIA Container Toolkit** | –ü–æ—Å–ª–µ–¥–Ω—è—è | –î–ª—è —Ä–∞–±–æ—Ç—ã —Å GPU –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ |

> üí° **–ë–µ–∑ GPU**: —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ CPU, –Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ (–≤ 5-10 —Ä–∞–∑).

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone https://github.com/dronzhin/Algofusion.git
cd Algofusion/OCR

# –ò–õ–ò –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ OCR (—Ç—Ä–µ–±—É–µ—Ç—Å—è Git 2.30+)
git clone --filter=blob:none --sparse https://github.com/dronzhin/Algofusion.git
cd Algofusion
git sparse-checkout set OCR
cd OCR
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
python3.11 -m venv venv
source venv/bin/activate
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install --upgrade pip
pip install -r requirements.txt

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PyTorch —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA 12.4 (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —á–µ—Ä–µ–∑ requirements)
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu124

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PaddlePaddle (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è —á–µ—Ä–µ–∑ requirements)
pip install paddlepaddle-gpu==2.6.2 -f https://www.paddlepaddle.org.cn/whl/linux/mkl/avx/stable.html
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
python -c "
import torch, paddle, transformers
print('‚úì PyTorch:', torch.__version__, '| CUDA:', torch.cuda.is_available())
if torch.cuda.is_available():
    print('  GPU:', torch.cuda.get_device_name(0), '| VRAM:', round(torch.cuda.get_device_properties(0).total_memory / 1024**3, 1), 'GB')
print('‚úì PaddlePaddle:', paddle.__version__, '| GPU:', paddle.is_compiled_with_cuda())
print('‚úì Transformers:', transformers.__version__)
"
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
‚úì PyTorch: 2.4.0 | CUDA: True
  GPU: NVIDIA RTX 4090 | VRAM: 23.7 GB
‚úì PaddlePaddle: 2.6.2 | GPU: True
‚úì Transformers: 4.46.0.dev0
```

---

## üê≥ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ NVIDIA Container Toolkit

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install -y docker.io docker-compose

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NVIDIA Container Toolkit
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | \
  sudo tee /etc/apt/sources.list.d/nvidia-docker.list
sudo apt-get update
sudo apt-get install -y nvidia-docker2
sudo systemctl restart docker
```

### 2. –°–±–æ—Ä–∫–∞ Docker-–æ–±—Ä–∞–∑–∞

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –ø—Ä–æ–µ–∫—Ç–æ–º
cd Algofusion/OCR

# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t ocr-server:latest .
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏):
```
‚úì PyTorch CUDA: True
‚úì PaddlePaddle CUDA: True
‚úì GPU name: NVIDIA RTX 4090
Successfully built abcdef123456
Successfully tagged ocr-server:latest
```

### 3. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

#### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ GPU:

```bash
docker run --gpus all \
  -p 8000:8000 \
  --name ocr-server \
  -v $(pwd)/logs:/app/logs \
  ocr-server:latest
```

#### –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
docker run --gpus all \
  -p 8000:8000 \
  --name ocr-server \
  -v $(pwd)/logs:/app/logs \
  -e HF_TOKEN=hf_your_token_here \
  ocr-server:latest
```

#### –ó–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ (detached):

```bash
docker run -d --gpus all \
  -p 8000:8000 \
  --name ocr-server \
  -v $(pwd)/logs:/app/logs \
  ocr-server:latest
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker logs ocr-server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker ps | grep ocr-server

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker stop ocr-server

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker restart ocr-server

# –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker rm ocr-server
```

### 5. Docker Compose (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±)

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.yml` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```yaml
version: '3.8'

services:
  ocr-server:
    build: .
    ports:
      - "8000:8000"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - HF_TOKEN=${HF_TOKEN:-}
    volumes:
      - ./logs:/app/logs
      - ./models_cache:/app/.cache/huggingface
    restart: unless-stopped
```

–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose:

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

---

## üöÄ –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω-—Ä–µ–∂–∏–º

```bash
python app.py
```

–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```
15:30:45 | INFO      | ======================================================================
15:30:45 | INFO      | –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ | –£—Ä–æ–≤–µ–Ω—å: INFO | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /home/user/Algofusion/OCR/logs
15:30:45 | INFO      | –†–æ—Ç–∞—Ü–∏—è: –º–∞–∫—Å–∏–º—É–º 3 —Ñ–∞–π–ª–∞ –ø–æ 3 –ú–ë –∫–∞–∂–¥—ã–π
15:30:45 | INFO      | ======================================================================
15:30:45 | INFO      | ======================================================================
15:30:45 | INFO      | üöÄ Unified OCR Server –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...
15:30:45 | INFO      |    PyTorch CUDA: True
15:30:45 | INFO      |    GPU: NVIDIA RTX 4090 | VRAM: 23.7 GB
15:30:45 | INFO      | ======================================================================
...
15:30:46 | INFO      | üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://localhost:8000
15:30:46 | INFO      |    –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs
```

### –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π

```bash
# –°–ø–æ—Å–æ–± 1: —á–µ—Ä–µ–∑ —Å–∫—Ä–∏–ø—Ç
./run_dev.sh

# –°–ø–æ—Å–æ–± 2: –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ uvicorn
uvicorn app:app \
  --host 0.0.0.0 \
  --port 8000 \
  --reload \
  --reload-dir ./models \
  --reload-dir ./utils \
  --log-level info \
  --access-log
```

> üí° –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–¥–∞ –≤ —Ñ–∞–π–ª–∞—Ö `app.py`, `models/*.py` –∏–ª–∏ `utils/*.py` —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è.

---

## üîç –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### üåê API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-------|----------|
| `/` | `GET` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–µ—Ä–≤–µ—Ä–∞ |
| `/models` | `GET` | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π |
| `/ocr` | `POST` | –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ PDF) |
| `/docs` | `GET` | –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger UI |

### üì§ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/ocr`

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|--------------|----------|
| `model_name` | string | ‚úÖ –î–∞ | ‚Äî | `deepseek-ocr`, `deepseek-ocr2`, `paddleocr-vl-1.5`, `glm-ocr` |
| `image` | file | ‚úÖ –î–∞ | ‚Äî | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (JPG, PNG, BMP, TIFF, WEBP) –∏–ª–∏ PDF |
| `prompt` | string | ‚ùå –ù–µ—Ç | `Extract all text` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏ |
| `return_confidence` | boolean | ‚ùå –ù–µ—Ç | `true` | –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª–∏ –º–µ—Ç—Ä–∏–∫—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ |

---

### üîß –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ curl

#### 1. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–±–µ–∑ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)

```bash
curl -X POST http://localhost:8000/ocr \
  -F "model_name=glm-ocr" \
  -F "prompt=Text Recognition:" \
  -F "image=@document.jpg" \
  -F "return_confidence=false"
```

#### 2. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ PDF —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é

```bash
curl -X POST http://localhost:8000/ocr \
  -F "model_name=deepseek-ocr2" \
  -F "prompt=Extract all text preserving tables and structure" \
  -F "image=@invoice.pdf" \
  -F "return_confidence=true" \
  -o result.json
```

#### 3. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

```bash
curl -X POST http://localhost:8000/ocr \
  -F "model_name=deepseek-ocr2" \
  -F "prompt=Extract table data in Markdown format with headers preserved" \
  -F "image=@table.png"
```

#### 4. –ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç (–∫–∏—Ç–∞–π—Å–∫–∏–π + –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)

```bash
curl -X POST http://localhost:8000/ocr \
  -F "model_name=paddleocr-vl-1.5" \
  -F "prompt=Extract all text including Chinese characters" \
  -F "image=@chinese_document.jpg"
```

---

### üíª Python –∫–ª–∏–µ–Ω—Ç

```python
#!/usr/bin/env python3
"""
–ü—Ä–∏–º–µ—Ä –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OCR —Å–µ—Ä–≤–µ—Ä–æ–º
"""

import requests
import json
from pathlib import Path


class OCRClient:
    def __init__(self, base_url: str = "http://localhost:8000"):
        self.base_url = base_url
    
    def recognize(
        self,
        file_path: str,
        model_name: str = "glm-ocr",
        prompt: str = "Extract all text",
        return_confidence: bool = True
    ) -> dict:
        """
        –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ PDF
        
        Args:
            file_path: –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É
            model_name: –∏–º—è –º–æ–¥–µ–ª–∏
            prompt: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –º–æ–¥–µ–ª–∏
            return_confidence: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ª–∏ –º–µ—Ç—Ä–∏–∫—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
            
        Returns:
            –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON
        """
        url = f"{self.base_url}/ocr"
        
        with open(file_path, 'rb') as f:
            files = {'image': f}
            data = {
                'model_name': model_name,
                'prompt': prompt,
                'return_confidence': str(return_confidence).lower()
            }
            
            response = requests.post(url, files=files, data=data)
        
        if response.status_code == 200:
            return response.json()
        else:
            raise Exception(f"–û—à–∏–±–∫–∞ {response.status_code}: {response.text}")
    
    def list_models(self) -> dict:
        """–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π"""
        response = requests.get(f"{self.base_url}/models")
        return response.json() if response.status_code == 200 else {}


# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    client = OCRClient()
    
    # 1. –°–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π
    print("üìä –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:")
    models = client.list_models()
    for model in models['available_models']:
        status = "‚úÖ –∑–∞–≥—Ä—É–∂–µ–Ω–∞" if model in models['loaded_models'] else "‚è≥ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞"
        print(f"  ‚Ä¢ {model:25s} {status}")
    
    print()
    
    # 2. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    print("üñºÔ∏è  –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...")
    result = client.recognize(
        file_path="test/sample.jpg",
        model_name="glm-ocr",
        prompt="Text Recognition:",
        return_confidence=True
    )
    
    print(f"‚úÖ –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result['confidence']:.2f}")
    print(f"üìù –¢–µ–∫—Å—Ç (–ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤):\n{result['text'][:200]}...\n")
    
    # 3. –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ PDF
    print("üìÑ –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ PDF...")
    pdf_result = client.recognize(
        file_path="test/multi_page.pdf",
        model_name="deepseek-ocr2",
        prompt="Extract all text preserving structure",
        return_confidence=True
    )
    
    print(f"‚úÖ –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü: {pdf_result['total_pages']}")
    print(f"üìä –û–±—â–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞: {pdf_result['confidence']:.2f}")
    print(f"‚è±Ô∏è  –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: {pdf_result['timing']['total_seconds']} —Å–µ–∫\n")
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    output_file = "result.json"
    with open(output_file, 'w', encoding='utf-8') as f:
        json.dump(pdf_result, f, ensure_ascii=False, indent=2)
    
    print(f"üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤: {output_file}")
```

–ó–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞:
```bash
python client.py
```

---

## üìä –ü—Ä–∏–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

### ‚úÖ –û—Ç–≤–µ—Ç –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

```json
{
  "model": "glm-ocr",
  "prompt": "Text Recognition:",
  "file_type": "image",
  "text": "Invoice Number: INV-2026-001\nDate: 2026-02-03\nVendor: Algofusion Ltd\nTotal Amount: $1,250.00",
  "confidence": 0.87,
  "status": "success",
  "timing": {
    "inference_seconds": 1.85,
    "total_seconds": 2.12
  },
  "request_id": "req_1707053712000"
}
```

### ‚úÖ –û—Ç–≤–µ—Ç –¥–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ PDF

```json
{
  "model": "deepseek-ocr2",
  "prompt": "Extract all text preserving tables",
  "file_type": "pdf",
  "total_pages": 3,
  "processed_pages": 3,
  "pages": [
    {
      "page_number": 1,
      "text": "INVOICE\nInvoice #: INV-2026-001\nDate: 2026-02-03\n...",
      "confidence": 0.92,
      "timing_seconds": 2.1
    },
    {
      "page_number": 2,
      "text": "| Item | Description | Qty | Price |\n|------|-------------|-----|-------|\n| 1 | Product A | 2 | $100 |\n...",
      "confidence": 0.78,
      "timing_seconds": 2.8
    },
    {
      "page_number": 3,
      "text": "Terms and Conditions:\nPayment due within 30 days...\n",
      "confidence": 0.85,
      "timing_seconds": 1.9
    }
  ],
  "combined_text": "[–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1]\nINVOICE\nInvoice #: INV-2026-001\n...\n\n--- –°–¢–†–ê–ù–ò–¶–ê –†–ê–ó–î–ï–õ–ò–¢–ï–õ–¨ ---\n\n[–°—Ç—Ä–∞–Ω–∏—Ü–∞ 2]\n| Item | Description | Qty | Price |...",
  "confidence": 0.78,
  "confidence_per_page": [0.92, 0.78, 0.85],
  "status": "success",
  "timing": {
    "total_seconds": 7.2,
    "pages": [2.1, 2.8, 1.9]
  },
  "request_id": "req_1707053712001"
}
```

### ‚ùå –û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ

```json
{
  "detail": "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ deepseek-ocr2: 404 Client Error: Not Found for url: https://huggingface.co/deepseek-ai/DeepSeek-OCR-2/..."
}
```

---

## üß† –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏

| –°—Ü–µ–Ω–∞—Ä–∏–π | –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –º–æ–¥–µ–ª—å | –ü—Ä–∏—á–∏–Ω–∞ |
|----------|----------------------|---------|
| **–ü—Ä–æ—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** | `glm-ocr` | –°–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è (0.9B), –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ—á–Ω–∞—è –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –∑–∞–¥–∞—á |
| **–¢–∞–±–ª–∏—Ü—ã –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** | `deepseek-ocr2` | –õ—É—á—à–µ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫ |
| **–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã —Å –ø–æ–ª—è–º–∏** | `deepseek-ocr2` | –ü–æ–Ω–∏–º–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —á—Ç–µ–Ω–∏—è (Visual Causal Flow) |
| **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã** | `paddleocr-vl-1.5` | –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –∫–∏—Ç–∞–π—Å–∫–æ–º, —è–ø–æ–Ω—Å–∫–æ–º, –∫–æ—Ä–µ–π—Å–∫–æ–º —è–∑—ã–∫–∞—Ö |
| **–†—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç** | `deepseek-ocr` | –ë–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –≤–∞—Ä–∏–∞—Ü–∏—è–º –ø–æ—á–µ—Ä–∫–∞ |
| **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å** | `deepseek-ocr2` | –ù–∞–∏–ª—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ –±–µ–Ω—á–º–∞—Ä–∫–µ OmniDocBench v1.5 |

> üí° **–°–æ–≤–µ—Ç:** –î–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–Ω—Å–∞–º–±–ª—å –º–æ–¥–µ–ª–µ–π ‚Äî —Å—Ä–∞–≤–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã 2-3 –º–æ–¥–µ–ª–µ–π –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é.

---

## üìä –ú–µ—Ç—Ä–∏–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

–°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—É—é –º–µ—Ç—Ä–∏–∫—É —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏** –æ—Ç 0.0 –¥–æ 1.0:

| –î–∏–∞–ø–∞–∑–æ–Ω | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|----------|---------------|--------------|
| **‚â• 0.85** | –í—ã—Å–æ–∫–∞—è | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ |
| **0.70 ‚Äì 0.84** | –°—Ä–µ–¥–Ω—è—è | ‚ö†Ô∏è –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π (—Å—É–º–º—ã, –¥–∞—Ç—ã) |
| **< 0.70** | –ù–∏–∑–∫–∞—è | ‚ùå –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–æ–ª–Ω–∞—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ |

### –ö–∞–∫ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å

```
–ò—Ç–æ–≥–æ–≤–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å = 0.7 √ó –¢–æ–∫–µ–Ω–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å + 0.3 √ó –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å

–ì–¥–µ:
‚Ä¢ –¢–æ–∫–µ–Ω–Ω–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Äî —Å—Ä–µ–¥–Ω—è—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (–¥–ª—è –º–æ–¥–µ–ª–µ–π —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –ª–æ–≥–∏—Ç–∞–º)
‚Ä¢ –≠–≤—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å ‚Äî –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –≤—ã–≤–æ–¥–∞:
  - –î–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞
  - –ù–∞–ª–∏—á–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤
  - –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –±—É–∫–≤/—Ü–∏—Ñ—Ä/—Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
  - –†–∞–∑–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –†–∞—Å—á—ë—Ç —Ç–æ–∫–µ–Ω–Ω–æ–π —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ 20-30%. –î–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä `return_confidence=false`.

---

## üìù –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `logs/` —Å —Ä–æ—Ç–∞—Ü–∏–µ–π —Ñ–∞–π–ª–æ–≤:

```
logs/
‚îú‚îÄ‚îÄ ocr_server.log      # –¢–µ–∫—É—â–∏–π –ª–æ–≥-—Ñ–∞–π–ª (–º–∞–∫—Å. 3 –ú–ë)
‚îú‚îÄ‚îÄ ocr_server.log.1    # –ü—Ä–µ–¥—ã–¥—É—â–∞—è –≤–µ—Ä—Å–∏—è (–º–∞–∫—Å. 3 –ú–ë)
‚îî‚îÄ‚îÄ ocr_server.log.2    # –°–∞–º–∞—è —Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è (–º–∞–∫—Å. 3 –ú–ë)
```

### –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞

```
2026-02-04 15:35:12 | INFO     | ocr_server | app.py:145   | [req_1707053712000] üì• –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å | –ú–æ–¥–µ–ª—å: glm-ocr | –§–∞–π–ª: invoice.pdf
2026-02-04 15:35:12 | INFO     | ocr_server | pdf_handler.py:45 | üìÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω –º–Ω–æ–≥–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π PDF | –°—Ç—Ä–∞–Ω–∏—Ü: 3
2026-02-04 15:35:14 | INFO     | ocr_server | glm_ocr.py:88 | ‚úÖ GLM-OCR –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | –í—Ä–µ–º—è: 1.85 —Å–µ–∫ | –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: 0.87
2026-02-04 15:35:16 | INFO     | ocr_server | app.py:210   | [req_1707053712000] ‚úÖ PDF –æ–±—Ä–∞–±–æ—Ç–∞–Ω | –í—Å–µ–≥–æ: 4.23 —Å–µ–∫ | –°—Ç—Ä–∞–Ω–∏—Ü: 3
```

### –£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

| –£—Ä–æ–≤–µ–Ω—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|---------|-------------------|
| `DEBUG` | –î–µ—Ç–∞–ª—å–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ (—Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –ø—Ä–æ–º–ø—Ç—ã) |
| `INFO`  | –û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π, —É—Å–ø–µ—à–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã) |
| `WARNING` | –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–Ω–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å) |
| `ERROR` | –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ) |
| `CRITICAL` | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–±–æ–∏ (–æ—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞) |

---

## ‚öôÔ∏è –°–æ–≤–µ—Ç—ã –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–µ—Ä–∞

–î–æ–±–∞–≤—å—Ç–µ –≤ `app.py` –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `lifespan`:

```python
# –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–∞–∏–±–æ–ª–µ–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–æ–¥–µ–ª–µ–π
logger.info("‚è≥ –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π...")
from models import GLMOCRModel, DeepSeekOCR2Model
models["glm-ocr"] = GLMOCRModel()
models["deepseek-ocr2"] = DeepSeekOCR2Model()
logger.info("‚úÖ –ú–æ–¥–µ–ª–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω—ã")
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

–î–ª—è —Å–∏—Å—Ç–µ–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –º–æ–¥–µ–ª—å:

```python
# –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –ø–æ—Å–ª–µ –∏–º–ø–æ—Ä—Ç–æ–≤
ACTIVE_MODEL = "glm-ocr"  # –¢–æ–ª—å–∫–æ –æ–¥–Ω–∞ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç—å

# –í —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
if model_name != ACTIVE_MODEL:
    raise HTTPException(
        status_code=400,
        detail=f"–î–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –º–æ–¥–µ–ª—å '{ACTIVE_MODEL}' (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏)"
    )
```

### 3. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–î–ª—è —á–∞—Å—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ—Å—Ç–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
from functools import lru_cache
import hashlib

@lru_cache(maxsize=100)
def cached_ocr(file_hash: str, model_name: str, prompt: str) -> str:
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    pass

# –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
file_hash = hashlib.md5(file_bytes).hexdigest()
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Docker

–î–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–Ω–æ–≥–æ—Å—Ç—É–ø–µ–Ω—á–∞—Ç—É—é —Å–±–æ—Ä–∫—É:

```dockerfile
# Stage 1: —Å–±–æ—Ä–∫–∞ —Å –ø–æ–ª–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
FROM nvidia/cuda:12.4.0-runtime-ubuntu22.04 as builder
# ... —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ...

# Stage 2: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–Ω—Ç–∞–π–º
FROM nvidia/cuda:12.4.0-runtime-ubuntu22.04
COPY --from=builder /usr/local/lib/python3.11/dist-packages /usr/local/lib/python3.11/dist-packages
COPY --from=builder /app /app
# ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã ...
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ì–ª—É–±–æ–∫–∏–µ —Ç–∞–±–ª–∏—Ü—ã** ‚Äî –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç —Ç–µ—Ä—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–∏ —Ç–∞–±–ª–∏—Ü–∞—Ö –±–æ–ª–µ–µ 10 –∫–æ–ª–æ–Ω–æ–∫
2. **–ü–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è** ‚Äî –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç —Ç–æ—á–Ω–æ—Å—Ç—å
3. **–†—É–∫–æ–ø–∏—Å–Ω—ã–π —Ç–µ–∫—Å—Ç** ‚Äî —Ç–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä—É–∫–æ–ø–∏—Å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ ~60-70% (–ø—Ä–æ—Ç–∏–≤ 95%+ –¥–ª—è –ø–µ—á–∞—Ç–Ω–æ–≥–æ)
4. **–ü–∞–º—è—Ç—å GPU** ‚Äî –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö 4 –º–æ–¥–µ–ª–µ–π —Ç—Ä–µ–±—É–µ—Ç 24+ –ì–ë VRAM
5. **DeepSeek-OCR 2** ‚Äî –º–æ–¥–µ–ª—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ Hugging Face (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏:

```python
#!/usr/bin/env python3
"""–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ –æ–¥–Ω–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏"""

import requests
import time

TEST_IMAGE = "test/invoice.jpg"
MODELS = ["deepseek-ocr", "deepseek-ocr2", "paddleocr-vl-1.5", "glm-ocr"]

print(f"üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏: {TEST_IMAGE}\n")
print(f"{'–ú–æ–¥–µ–ª—å':25} | {'–í—Ä–µ–º—è':8} | {'–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å':12} | –†–µ–∑—É–ª—å—Ç–∞—Ç (–ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤)")
print("-" * 80)

for model in MODELS:
    start = time.time()
    
    try:
        with open(TEST_IMAGE, 'rb') as f:
            files = {'image': f}
            data = {
                'model_name': model,
                'prompt': 'Extract all text',
                'return_confidence': 'true'
            }
            response = requests.post('http://localhost:8000/ocr', files=files, data=data)
        
        if response.status_code == 200:
            result = response.json()
            elapsed = time.time() - start
            confidence = result.get('confidence', 'N/A')
            text_preview = result['text'][:50].replace('\n', ' ')
            
            print(f"{model:25} | {elapsed:6.2f} —Å | {confidence:12} | {text_preview}...")
        else:
            print(f"{model:25} | –û—à–∏–±–∫–∞ {response.status_code}")
            
    except Exception as e:
        print(f"{model:25} | ‚ùå {str(e)[:40]}")

print("\n‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")
```

---